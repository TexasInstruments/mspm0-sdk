<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Energy Metrology SW Overview &mdash; Energy_Metrology_SW_Overview 2.0.0.x documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Energy Measurement Library" href="Energy_Metrology_Library_CN.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Energy_Metrology_SW_Overview
          </a>
              <div class="version">
                2.0.0.x
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_CCS_User_Guide_CN.html">Energy Metrology CCS User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_GUI_User_Guide_CN.html">Energy Library GUI User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_Library_CN.html">Energy Measurement Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_Library_CN.html#background-process">Background Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_Library_CN.html#foreground-process">Foreground Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_Library_CN.html#metrology-calculations">Metrology Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_Library_CN.html#rms-calculations">RMS Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_Library_CN.html#power-calculations">Power Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_Library_CN.html#energy-calculations">Energy Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_Library_CN.html#other-calculations">Other Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Energy_Metrology_Library_CN.html#sag-or-swell-detection">Sag or Swell Detection</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Energy Metrology SW Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hal-module">HAL Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enums">Enums</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ti-sysconfig">TI SysConfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ads-amc-module">ADS/AMC Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metrology-module">Metrology Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#communication-module">Communication Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-module">Application Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-guide">API Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="#known-issues">Known Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-devices">Supported Devices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tida-010243">TIDA-010243</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Energy_Metrology_SW_Overview</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Energy Metrology SW Overview</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="energy-metrology-sw-overview">
<h1>Energy Metrology SW Overview<a class="headerlink" href="#energy-metrology-sw-overview" title="Permalink to this heading">¶</a></h1>
<p>The Energy Measurement software is divided three layers. The MSPM0 DriverLib layer consists of all the peripherals defined and is configured using SysConfig. The module layer contains four modules, Hardware Abstraction Layer (HAL) module, Analog front end converter (ADS131M0x) module, Metrology module, Communication module (DLT645). The HAL module provides Application Programming Interfaces (APIs) to manipulate and configure MCU pins and peripherals. The Analog front end module provides Application Programming Interfaces (APIs) related to configuration of ADS131M0x and SPI communication. The metrology module provides the APIs to process the sampled data and do the mathematical calculations. The communication module is used to receive commands from GUI and send the computation results to GUI. The application module the place where the user will specify the required configuration of each module and start the measurement process.</p>
<section id="hal-module">
<h2>HAL Module<a class="headerlink" href="#hal-module" title="Permalink to this heading">¶</a></h2>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h3>
<p>The HAL module consists of microcontroller-specific code that provides generic APIs to control and configure the user-defined pins and peripherals. The HAL APIs are developed to allow changing the HAL module used without requiring any code changes to other modules.</p>
<p>The HAL is purposely meant to only abstract the key pins and peripherals needed to run the energy measurement. A user is free to expand the HAL’s API to use other pins, peripherals and features of the microcontroller but its strongly recommended not to modify existing APIs to ensure ease migration to new versions of this library.</p>
<p>No application specific code or ADS specific code should exist in the HAL layer or in its API. Instead, it treats the pins and peripherals in a generic manner. For example, an ADS131M0x likely has a RESET/SYNC pin but the HAL layer will only provide APIs to control the state of a GPIO output pin. It’s the responsibility of the ADS131M0x module to associate the specific HAL GPIO output pin to the ADS’s RESET/SYNC pin.</p>
</section>
<section id="enums">
<h3>Enums<a class="headerlink" href="#enums" title="Permalink to this heading">¶</a></h3>
<p>The HAL layer uses enums to determine the generic references to different peripherals. Each peripheral has separate enums that are associated with pins used in that peripheral. This allows the user to change the peripheral pins without changing the code in other modules that utilizes its API. For example, the SYNC/RESET pin in the ADS module is associated with one enum in a GPIO peripheral. The user can change the pin associated with the GPIO enum without any code changes in ADS module. Consider an enum HAL_GPIO_OUT in which total number of enums represent the maximum number of GPIOs used as outputs.</p>
<p><img alt="image0" src="../_images/sw_overview_gpio_enum.png" /></p>
<p style="text-align: left;"><p>Figure 2 - enum representing GPIO output pins</p>
</p><p>Figure 2 shows an example of an enum that represents 4 different GPIO output pins. The purpose of this enum is to provide a way for the HAL and ADS APIs to reference GPIO outputs in a generic manner. The number of GPIOs determined here are based on the application requirement and the user is free to add or delete the number of GPIOs based on their application. The user will need to keep in mind the maximum amount of GPIO output pins required by different ADS devices supported in their software.</p>
<p><img alt="image1" src="../_images/sw_overview_gpio_defines.png" /></p>
<p style="text-align: left;"><p>Figure 3 - Enum to MCU pin mapping</p>
</p><p>Figure 3 shows a snippet from the MSPM0G3507 HAL which shows how the HAL_GPIO_OUT_02 enum is now associated with a specific GPIO on the MSPM0G3507. GEN_GPIO_OUT_XXXX defines are from TI SysConfig, which will be discussed later. Note that each of those defines are representing values needed by the MSPM0’s DriverLib API to manipulate the specific pin.</p>
<p><img alt="image2" src="../_images/sw_overview_gpio_output_api.png" /></p>
<p style="text-align: left;"><p>Figure 4 - HAL API example</p>
</p><p>Now that the HAL provides the information needed to associate an enum to a specific pin, HAL_writeGPIOPin() shows the API used to change the output value of a pin associated with a given HAL_GPIO_OUT enum. It is important to note that the enum value is translated to MSPM0’s DriverLib API calls by utilizing internal structures and arrays in the HAL.</p>
<p><img alt="image3" src="../_images/sw_overview_driver_hal_map.png" /></p>
<p style="text-align: left;"><p>Figure 5 - ADS131M0x to HAL mapping</p>
</p><p>Finally when the user wants to change the output value of the RESET/SYNC pin, the user can call the generic HAL API while providing the enum value that is associated with the RESET/SYNC pin to make the change. Although this example is focused on HAL_GPIO_OUT enum, the concept is the same for every other pin/peripheral the HAL has created enums for, such as PWM, ADC inputs, GPIO inputs and SPI enums.</p>
</section>
</section>
<section id="ti-sysconfig">
<h2>TI SysConfig<a class="headerlink" href="#ti-sysconfig" title="Permalink to this heading">¶</a></h2>
<p>MSPM0 software utilizes a GUI tool called TI SysConfig to simplify configuration of pins and peripherals. Almost all MSPM0 SDK examples utilize SysConfig. For more information on how SysConfig works and how to use it, see TI SysConfig. It is important to note that the HAL modules provided by the SDK use SysConfig which is why you will not see DriverLib API calls to initialize peripherals and pins. Instead, the HAL uses defines created by SysConfig to map the specific pins and peripherals to the different generic HAL enums. Figure 3 shows how the GEN_GPIO_OUT_XXXX defines created by SysConfig are then mapped to the HAL structures and enum value.</p>
</section>
<section id="ads-amc-module">
<h2>ADS/AMC Module<a class="headerlink" href="#ads-amc-module" title="Permalink to this heading">¶</a></h2>
<p>The Energy Metrology Software utilizes a high performance ADC to sense the Mains voltage and current at sample rates up to 8 kHz. When the ADC produces new samples, it interrupts the MCU to request a data access through serial peripheral interface (SPI). When the host MCU receives the data ready (DRDY) interrupt, it issues a read of a new set of samples via SPI. These samples are aggregated with past samples to calculate metrology parameters.</p>
<p>This module separates the ADS/AMC configuration from the main code. These files provide ADS/AMC register definitions, APIs to initialize ADS/AMC, read and write to registers, APIs to communicate through SPI and DMA, structure to store the converted value of ADC. The ADS_instance structure holds all the pins and variables that stores data related to particular ADS/AMC. When using multiple ADS/AMCs, it is easy to create duplicate ADS/AMC. This module uses APIs from HAL module to configure the pins and MCU peripherals.</p>
</section>
<section id="metrology-module">
<h2>Metrology Module<a class="headerlink" href="#metrology-module" title="Permalink to this heading">¶</a></h2>
<p>The metrology module is developed to process the sampled data and compute various metrology parameters for energy measurement. These parameters are collected by the calibration GUI for display. The key parameters calculated during energy measurements are:</p>
<ul class="simple">
<li><p>Total and per phase active (kWh), reactive (kvarh), apparent energy (kVAh)</p></li>
<li><p>Total and per phase active (kW), reactive (kvar), apparent power (kVA)</p></li>
<li><p>Total and per phase fundamental active energy</p></li>
<li><p>Total and per phase fundamental active power</p></li>
<li><p>Total and per phase power factor</p></li>
<li><p>Per phase voltage and current root mean square (RMS)</p></li>
<li><p>Line frequency</p></li>
<li><p>Supply voltage dips/sags, swells, interruptions, under and over deviation</p></li>
<li><p>Per Phase Voltage THD</p></li>
<li><p>Per Phase Current THD</p></li>
<li><p>Voltage phase to phase angle</p></li>
<li><p>Per phase zero crossing</p></li>
</ul>
</section>
<section id="communication-module">
<h2>Communication Module<a class="headerlink" href="#communication-module" title="Permalink to this heading">¶</a></h2>
<p>This module is used to communicate with GUI or any other controller over any communication module. In this example we are communicating to GUI over UART. This module uses the APIs from Metrology module to read the metrology parameters and APIs from HAL module to communicate over UART.</p>
</section>
<section id="application-module">
<h2>Application Module<a class="headerlink" href="#application-module" title="Permalink to this heading">¶</a></h2>
<p>This module allows the user to define and implement specific requirements. User needs to assign the correct MCU pins the application is using, specify the required parameters to compute.</p>
</section>
<section id="api-guide">
<h2>API Guide<a class="headerlink" href="#api-guide" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="../../doxygen/api_guide/html/index.html">Energy Library API Guide</a></p></li>
</ul>
</section>
<section id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this heading">¶</a></h2>
</section>
<section id="supported-devices">
<h2>Supported Devices<a class="headerlink" href="#supported-devices" title="Permalink to this heading">¶</a></h2>
<section id="tida-010243">
<h3>TIDA-010243<a class="headerlink" href="#tida-010243" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.ti.com/product/MSPM0G3507">MSPM0G3507</a></p></li>
<li><p><a class="reference external" href="https://www.ti.com/tool/TIDA-010243">TIDA-010243</a></p></li>
<li><p><a class="reference external" href="https://www.ti.com/product/ADS131M08">ADS131M08</a></p></li>
</ul>
<p>Documents</p>
<ul class="simple">
<li><p><a class="reference external" href="Energy_Metrology_Library_CN.html">Metrology Library</a></p></li>
<li><p><a class="reference external" href="Energy_Metrology_CCS_User_Guide_CN.html">CCS User Guide</a></p></li>
<li><p><a class="reference external" href="Energy_Metrology_GUI_User_Guide_CN.html">GUI User Guide</a></p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Energy_Metrology_Library_CN.html" class="btn btn-neutral float-left" title="Energy Measurement Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="https://www.ti.com/corp/docs/legal/copyright.shtml">1995-2023, Texas Instruments Incorporated. All rights reserved</a>, Texas Instruments Incorporated. All rights reserved. <br/>
      <a href="https://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="https://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="https://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="https://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>